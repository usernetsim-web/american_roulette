<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Рулетка с вынесенным зелёным полем 0</title>
<style>
  body {
    margin: 0;
    background: #0a1a2a;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #eee;
    user-select: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
  }
  #game {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    width: 100%;
    max-width: 480px;
    margin: 0 auto;
    padding-bottom: 20px;
  }
  #canvas-container {
    width: 100%;
    max-width: 450px;
    aspect-ratio: 1 / 1;
    user-select: none;
    margin: 0 auto;
  }
  canvas {
    width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
    border-radius: 50%;
    box-shadow:
      inset 0 0 50px #a36a00,
      0 0 30px #a36a00;
  }
  /* Таблица ставок с отдельным полем 0 */
  #table {
    background: #0b3d0b;
    border-radius: 10px;
    padding: 10px 8px;
    width: 100%;
    max-width: 450px;
    box-shadow: 0 0 20px #144214;
    display: flex;
    gap: 8px;
    align-items: stretch;
  }
  #zero-cell {
    flex-shrink: 0;
    width: 48px;
    background: #006400;
    border-radius: 10px;
    font-weight: 700;
    font-size: 18px;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 0 8px #0a5a0a inset;
    transition: outline 0.2s ease;
  }
  #zero-cell.selected {
    outline: 3px solid yellow;
    box-shadow: 0 0 12px yellow inset;
  }
  #table-grid {
    overflow-y: auto;
    max-height: 180px;
    flex-grow: 1;
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    grid-template-rows: repeat(3, 36px);
    gap: 1px;
    user-select: none;
  }
  .cell {
    font-size: 14px;
    line-height: 36px;
    cursor: pointer;
    border-radius: 3px;
    border: 1px solid #222;
    text-align: center;
    font-weight: 700;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    transition: outline 0.2s ease;
  }
  .red {
    background: #b22222;
  }
  .black {
    background: #111;
  }
  .cell.selected {
    outline: 3px solid yellow;
    box-shadow: 0 0 10px yellow inset;
    z-index: 10;
  }
  #bet-container {
    margin-top: 8px;
    width: 100%;
    max-width: 450px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 5px;
  }
  #bet-input {
    width: 70px;
    font-size: 14px;
    padding: 5px;
    border-radius: 5px;
    border: 1px solid #0a2a0a;
    text-align: right;
  }
  #controls {
    margin-top: 10px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
    max-width: 450px;
  }
  button {
    flex: 1 1 45%;
    min-width: 100px;
    font-size: 14px;
    padding: 8px 0;
    border-radius: 6px;
    background: #144214;
    border: 1px solid #0a2a0a;
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  button:hover:not(:disabled) {
    background: #1e6f1e;
  }
  button:disabled {
    background: #555;
    cursor: not-allowed;
  }
  #result {
    margin-top: 15px;
    font-size: 18px;
    font-weight: 700;
    min-height: 28px;
    min-width: 240px;
    text-align: center;
  }

  @media (max-width: 480px) {
    #table-grid {
      grid-template-rows: repeat(3, 32px);
    }
    .cell {
      font-size: 12px;
      line-height: 32px;
    }
    #zero-cell {
      font-size: 16px;
      width: 44px;
    }
    #bet-input {
      width: 60px;
      font-size: 12px;
    }
    button {
      font-size: 12px;
      min-width: 90px;
    }
    #result {
      font-size: 16px;
      min-width: auto;
      padding: 0 5px;
    }
  }
</style>
</head>
<body>

<div id="game">
  <div id="canvas-container">
    <canvas id="roulette-canvas"></canvas>
  </div>

  <div id="table">
    <div id="zero-cell">0</div>
    <div id="table-grid"></div>
  </div>

  <div id="bet-container">
    <label for="bet-input">Ставка:</label>
    <input id="bet-input" type="number" min="1" value="10" step="1" />
    <span>€</span>
  </div>

  <div id="controls">
    <button id="spin-btn" disabled>Вращать</button>
    <button id="clear-btn">Сбросить ставки</button>
  </div>

  <div id="result"></div>
</div>

<script>
(() => {
  const numbers = [
    0, 32, 15, 19, 4, 21, 2, 25, 17, 34,
    6, 27, 13, 36, 11, 30, 8, 23, 10, 5,
    24, 16, 33, 1, 20, 14, 31, 9, 22, 18,
    29, 7, 28, 12, 35, 3, 26
  ];
  const redNumbers = new Set([
    32, 19, 21, 25, 34, 27, 36, 30,
    23, 5, 16, 1, 14, 9, 18, 7, 12, 3
  ]);
  const blackNumbers = new Set(numbers.filter(n => n !== 0 && !redNumbers.has(n)));

  const canvas = document.getElementById('roulette-canvas');
  const ctx = canvas.getContext('2d');

  const baseSize = 450;
  let scale = 1;

  function resizeCanvas() {
    const containerWidth = canvas.parentElement.clientWidth;
    scale = containerWidth / baseSize;
    canvas.width = baseSize;
    canvas.height = baseSize;
    canvas.style.width = containerWidth + 'px';
    canvas.style.height = containerWidth + 'px';
  }

  resizeCanvas();
  window.addEventListener('resize', () => {
    resizeCanvas();
    drawWheel(currentWheelRotation);
    drawBall(currentWheelRotation, ballAngle, performance.now());
  });

  const cx = baseSize / 2;
  const cy = baseSize / 2;
  const outerRadius = 200;
  const innerRadius = 120;
  const ballRadius = 10;

  const totalSegments = numbers.length;
  const anglePerSegment = 2 * Math.PI / totalSegments;

  const tableGrid = document.getElementById('table-grid');
  const zeroCell = document.getElementById('zero-cell');
  const spinBtn = document.getElementById('spin-btn');
  const clearBtn = document.getElementById('clear-btn');
  const betInput = document.getElementById('bet-input');
  const resultDiv = document.getElementById('result');

  let bets = new Map();

  // Создаём ячейки 1–36 в table-grid
  for(let row=0; row<3; row++) {
    for(let col=0; col<12; col++) {
      const num = row * 12 + col + 1;
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.textContent = num;

      if(redNumbers.has(num)) {
        cell.classList.add('red');
      } else {
        cell.classList.add('black');
      }
      // grid-auto-placement, так что не нужно явно ставить grid-row/column

      cell.addEventListener('click', () => {
        if(spinning) return;
        if(bets.has(num)) {
          bets.delete(num);
          cell.classList.remove('selected');
        } else {
          bets.set(num, Number(betInput.value) || 1);
          cell.classList.add('selected');
        }
        updateSpinButton();
        updateResult('');
      });

      tableGrid.appendChild(cell);
    }
  }

  zeroCell.addEventListener('click', () => {
    if(spinning) return;
    if(bets.has(0)) {
      bets.delete(0);
      zeroCell.classList.remove('selected');
    } else {
      bets.set(0, Number(betInput.value) || 1);
      zeroCell.classList.add('selected');
    }
    updateSpinButton();
    updateResult('');
  });

  function updateSpinButton() {
    spinBtn.disabled = bets.size === 0;
  }

  clearBtn.addEventListener('click', () => {
    if(spinning) return;
    bets.clear();
    document.querySelectorAll('.cell.selected').forEach(el => el.classList.remove('selected'));
    zeroCell.classList.remove('selected');
    updateSpinButton();
    updateResult('');
  });

  function updateResult(text) {
    resultDiv.textContent = text;
  }

  function drawWheel(rotation) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.scale(scale, scale);

    // Внешний круг с градиентом
    const gradientOuter = ctx.createRadialGradient(cx, cy, outerRadius*0.7, cx, cy, outerRadius);
    gradientOuter.addColorStop(0, '#6b3e00');
    gradientOuter.addColorStop(1, '#2a1500');
    ctx.fillStyle = gradientOuter;
    ctx.beginPath();
    ctx.arc(cx, cy, outerRadius+10, 0, 2*Math.PI);
    ctx.fill();

    ctx.translate(cx, cy);
    ctx.rotate(rotation);

    for(let i=0; i<totalSegments; i++) {
      const startAngle = i * anglePerSegment;
      const endAngle = startAngle + anglePerSegment;
      const num = numbers[i];

      if(num === 0) {
        ctx.fillStyle = '#006400';
      } else if(redNumbers.has(num)) {
        ctx.fillStyle = '#b22222';
      } else {
        ctx.fillStyle = '#111';
      }

      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.arc(0,0, outerRadius, startAngle, endAngle, false);
      ctx.lineTo(0,0);
      ctx.closePath();
      ctx.fill();

      // Внутренний круг для кольца
      ctx.fillStyle = '#0a1a2a';
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.arc(0,0, innerRadius, endAngle, startAngle, true);
      ctx.closePath();
      ctx.fill();

      // Текст номера
      ctx.save();
      const textAngle = startAngle + anglePerSegment/2;
      ctx.rotate(textAngle);
      ctx.translate(innerRadius + (outerRadius - innerRadius)/2, 0);
      ctx.rotate(Math.PI/2);
      ctx.fillStyle = num === 0 ? '#a0dfa0' : redNumbers.has(num) ? '#ff6666' : '#dddcdc';
      ctx.font = 'bold 20px Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(num, 0, 0);
      ctx.restore();
    }

    ctx.resetTransform();

    // Центр колеса
    const gradientCenter = ctx.createRadialGradient(cx, cy, 10, cx, cy, 40);
    gradientCenter.addColorStop(0, '#ffda79');
    gradientCenter.addColorStop(1, '#a67c00');
    ctx.fillStyle = gradientCenter;
    ctx.beginPath();
    ctx.arc(cx, cy, 40, 0, 2*Math.PI);
    ctx.fill();

    ctx.strokeStyle = '#a67c00';
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.arc(cx, cy, 40, 0, 2*Math.PI);
    ctx.stroke();

    ctx.restore();
  }

  function drawBall(wheelRotation, ballAngle, timestamp) {
    ctx.save();
    ctx.scale(scale, scale);

    const bounceRadius = innerRadius + (outerRadius - innerRadius) / 2 * (1 + Math.sin(timestamp * 0.01));
    const angle = wheelRotation + ballAngle;
    const x = cx + bounceRadius * Math.cos(angle);
    const y = cy + bounceRadius * Math.sin(angle);

    ctx.shadowColor = 'rgba(255,255,255,0.8)';
    ctx.shadowBlur = 8;
    const gradientBall = ctx.createRadialGradient(x - 3, y - 3, 2, x, y, ballRadius);
    gradientBall.addColorStop(0, '#fff');
    gradientBall.addColorStop(1, '#999');
    ctx.fillStyle = gradientBall;
    ctx.beginPath();
    ctx.arc(x, y, ballRadius, 0, 2 * Math.PI);
    ctx.fill();
    ctx.shadowBlur = 0;

    ctx.restore();
  }

  let spinning = false;
  let currentWheelRotation = 0;
  let currentWheelSpeed = 0;
  let ballAngle = 0;
  let ballSpeed = 0;
  let spinStartTime = 0;

  function getNumberByBallAngle(wheelRotation, ballAngle) {
    let angle = (wheelRotation + ballAngle) % (2 * Math.PI);
    if (angle < 0) angle += 2 * Math.PI;

    const zeroAngle = 3/2 * Math.PI;
    let shiftedAngle = (zeroAngle - angle + 2 * Math.PI) % (2 * Math.PI);

    const index = Math.floor(shiftedAngle / anglePerSegment);
    return numbers[index];
  }

  function animate(timestamp) {
    if(!spinStartTime) spinStartTime = timestamp;
    if(!spinning) return;

    currentWheelRotation += currentWheelSpeed;
    ballAngle += ballSpeed;

    currentWheelSpeed *= 0.993;
    ballSpeed *= 0.993;

    drawWheel(currentWheelRotation);
    drawBall(currentWheelRotation, ballAngle, timestamp);

    if(currentWheelSpeed < 0.002 && ballSpeed < 0.002) {
      spinning = false;
      spinBtn.disabled = false;
      clearBtn.disabled = false;
      betInput.disabled = false;

      const resultNumber = getNumberByBallAngle(currentWheelRotation, ballAngle);
      showResult(resultNumber);
      return;
    }

    requestAnimationFrame(animate);
  }

  function showResult(number) {
    updateResult(`Выпало число: ${number} (${redNumbers.has(number) ? 'красное' : number === 0 ? 'зелёное' : 'чёрное'})`);

    let totalBet = 0;
    let winAmount = 0;
    bets.forEach((amount, num) => {
      totalBet += amount;
      if(num === number) {
        winAmount += amount * 35;
      }
    });

    if(winAmount > 0) {
      updateResult(`Выпало число: ${number}. Поздравляем! Ваш выигрыш: ${winAmount} € (ставка: ${totalBet} €)`);
    } else {
      updateResult(`Выпало число: ${number}. К сожалению, вы проиграли. Ставка: ${totalBet} €`);
    }

    bets.clear();
    document.querySelectorAll('.cell.selected').forEach(el => el.classList.remove('selected'));
    zeroCell.classList.remove('selected');
    updateSpinButton();
  }

  spinBtn.addEventListener('click', () => {
    if(spinning || bets.size === 0) return;

    spinning = true;
    spinBtn.disabled = true;
    clearBtn.disabled = true;
    betInput.disabled = true;
    updateResult('Вращаем...');

    currentWheelSpeed = 0.5 + Math.random() * 0.3;
    ballSpeed = currentWheelSpeed * 3 + 0.1;

    spinStartTime = 0;

    requestAnimationFrame(animate);
  });

  updateSpinButton();
  drawWheel(0);
  const initialTimestamp = performance.now();
  (function initialBall() {
    drawWheel(0);
    drawBall(0, 0, initialTimestamp);
  })();

})();
</script>

</body>
</html>
